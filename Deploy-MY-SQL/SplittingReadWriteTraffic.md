
### Init Container

1. **Init Container Definition**:
   ```yaml
   initContainers:
     - name: init-mysql
       image: mysql:5.7
       command:
         - bash
         - "-c"
         - |
           set -ex
           [[ $HOSTNAME =~ -([0-9]+)$ ]] || exit 1
           ordinals=${BASH_REMATCH[1]}
           echo [mysql] > /mnt/conf.d/server-id.cnf
           # Add an offset to avoid reserved server-id 0 value.
           echo server-id=$((100 + $ordinals)) >> /mnt/conf.d/server-id.cnf
           # Copy appropriate conf.d files from config-map to emptyDir.
           if [[ $ordinals -eq 0 ]]; then
             cp /mnt/config-map/primary.cnf /mnt/conf.d/
           else
             cp /mnt/config-map/replica.cnf /mnt/conf.d/
           fi
   ```

   - **Image**: Uses the `mysql:5.7` image.
   - **Command**: Executes a series of bash commands:
     - Extracts the ordinal index from the pod's hostname.
     - Generates a `server-id` for MySQL, ensuring itâ€™s unique by adding an offset of 100.
     - Depending on the pod's ordinal index, it copies the appropriate configuration file (`primary.cnf` for the primary pod and `replica.cnf` for the replicas) from the config map to the container's configuration directory.

### Volume Mounts
The configuration files are managed using Kubernetes volumes and config maps.

1. **Volume Mounts for Init Container**:
   ```yaml
   volumeMounts:
     - name: conf
       mountPath: /mnt/conf.d
     - name: config-map
       mountPath: /mnt/config-map
   ```

   - **conf**: Mounts to `/mnt/conf.d` where the configuration files are copied.
   - **config-map**: Mounts to `/mnt/config-map` where the source configuration files (`primary.cnf` and `replica.cnf`) are stored.

2. **Volume Mounts for Main Container**:
   ```yaml
   volumeMounts:
     - name: conf
       mountPath: /mnt/conf.d
   ```

### Main Container
The main MySQL container uses the `conf` volume to apply the configuration generated by the init container.

1. **Main Container Definition**:
   ```yaml
   image: clone-mysql
   volumeMounts:
     - name: conf
       mountPath: /mnt/conf.d
   ```
